<%
def message_tree(thread, messages, opts = {})
  opts = {prev_deleted: false, show_icons: false}.merge(opts)

  html = "<ol>\n"
  messages.each do |message|
    classes = []
    classes << 'active' if @message and @message.message_id == message.message_id

    html << "<li"
    html << " class=\"" + classes.join(" ") + "\"" unless classes.blank?
    html << ">"
    html << message_header(thread, message, first: false, prev_deleted: opts[:prev_deleted], show_icons: opts[:show_icons])
    html << message_tree(thread, message.messages, first: false, prev_deleted: message.deleted?, show_icons: opts[:show_icons]) unless message.messages.blank?
    html << "</li>"
  end

  html << "\n</ol>"

  html.html_safe
end
%>
