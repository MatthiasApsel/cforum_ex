<%
render 'cf_messages/message_header'
render 'cf_threads/thread_tree'
%>

<% def whole_thread(thread, messages) %>
  <ol class="answers">
    <% messages.each do |m| %>
    <li>
      <%= message_header(thread, m) %>

      <div class="posting-content well">
        <%= message_to_html(m.content) %>
      </div>

      <p><%= link_to t("views.new_answer"), new_cf_message_path(@thread, m) %>
        <%= link_to '', vote_cf_message_path(@thread, m, type: 'up'), :method => :post, :class => 'icon icon-arrow-up' %>
        <%= link_to '', vote_cf_message_path(@thread, m, type: 'down'), :method => :post, :class => 'icon icon-arrow-down' %>
      </p>

      <% unless m.messages.blank?
        whole_thread(thread, m.messages)
      end %>
    </li>
    <% end %>
  </ol>
<% end %>

<article class="thread">
  <%= message_header(@thread, @thread.message, first: true) %>

  <div class="posting-content well">
    <%= message_to_html(@thread.message.content) %>
  </div>

  <p><%= link_to t("views.new_answer"), new_cf_message_path(@thread, @thread.message) %>
    <%= link_to '', vote_cf_message_path(@thread, @thread.message, type: 'up'), :method => :post, :class => 'icon icon-arrow-up' %>
    <%= link_to '', vote_cf_message_path(@thread, @thread.message, type: 'down'), :method => :post, :class => 'icon icon-arrow-down' %>
  </p>

  <% unless @thread.message.messages.blank? %>
    <% whole_thread(@thread, @thread.message.messages) %>
  <% end %>
</article>
